- hosts: all
  become: yes
  become_user: root
  vars:
    discord_webhook: "{{ discord_webhook_url }}"
  tasks:
    - name: Update apk repo and cache on all Alpine boxes
      apk: update_cache=yes

#    - name: Ansible apt to install multiple packages
#      register: updatesys
#      apt:
#        update_cache: yes
#        name:
#          - snmp
#          - libsasl2-modules
#          - qemu-guest-agent
#        state: present
        
    - name: Upgrade all packages on servers
      apk: upgrade=yes

    - name: 發送成功通知
      include_role:
        name: discord_notify
      vars:
        discord_webhook_url: "{{ discord_webhook }}"
        discord_message: "✅ Alpine 系統更新完成"
        discord_title: "Ansible 執行成功"
        discord_description: "所有 Alpine 主機已完成系統更新"
        discord_color: 3066993
