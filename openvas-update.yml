- name: Execute Docker Compose operations on remote host
  hosts: all
  become: yes

  tasks:
    - name: Update package cache
      community.general.apk:
        update_cache: yes

    - name: Install Python3 and pip
      community.general.apk:
        name:
          - python3
          - py3-pip
        state: present

    - name: Install requests using pip
      ansible.builtin.pip:
        name: requests
        executable: pip3

    - name: Install docker using pip
      ansible.builtin.pip:
        name: docker
        executable: pip3

    - name: Stop and remove containers
      community.docker.docker_compose:
        project_src: /root  # docker-compose.yml 
        state: absent

    - name: Remove OpenVAS log file
      ansible.builtin.file:
        path: /var/lib/docker/volumes/root_openvas_log_data_vol/_data/openvas.log
        state: absent

    - name: Pull latest Docker images
      community.docker.docker_compose:
        project_src: /root  # docker-compose.yml 
        pull: yes

    - name: Start Docker Compose services
      community.docker.docker_compose:
        project_src: /root  # docker-compose.yml 
        state: present

    - name: Prune Docker images
      community.docker.docker_prune:
        images: yes
        images_filters:
          dangling: false
